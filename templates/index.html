<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Detección IA – Demo</title>
  <style>
    :root {
      --bg: #0b1220;
      --panel: #101a2b;
      --panel-border: #1c2a44;
      --text: #e6ecff;
      --subtext: #b7c2d8;
      --accent: #5b8cff;
      --ok: #22c55e;
      --warn: #f59e0b;
      --danger: #ef4444;
    }
    @media (prefers-color-scheme: light) {
      :root {
        --bg: #f7f9fc; --panel: #ffffff; --panel-border: #e5eaf3; --text: #0f172a; --subtext: #475569; --accent: #365cf5;
      }
    }
    * { box-sizing: border-box; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; color: var(--text); background: radial-gradient(1200px 600px at 20% -20%, #1a2a4a33, transparent), radial-gradient(1000px 800px at 120% 0%, #2a3a6a22, transparent), var(--bg); margin: 0; }
    .container { max-width: 1040px; margin: 0 auto; padding: 32px 20px; }
    header { margin-bottom: 16px; }
    h1 { margin: 0 0 6px; font-weight: 700; letter-spacing: .2px; }
    .subtitle { margin: 0; color: var(--subtext); }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px; margin-top: 16px; }
    .card { background: linear-gradient(180deg, var(--panel), #0b1324); border: 1px solid var(--panel-border); border-radius: 14px; padding: 16px; box-shadow: 0 10px 24px rgba(10, 20, 40, .25), inset 0 1px 0 rgba(255,255,255,.03); }
    .card h3 { margin-top: 0; }
    .preview { display: grid; grid-template-columns: 88px 1fr; gap: 12px; align-items: center; padding: 10px; border: 1px dashed var(--panel-border); border-radius: 12px; }
    .preview img { width: 88px; height: 88px; object-fit: cover; border-radius: 10px; border: 1px solid var(--panel-border); }
    .muted { color: var(--subtext); font-size: .95rem; }
    .btn { cursor: pointer; padding: .6rem .9rem; border-radius: 10px; border: 1px solid var(--panel-border); background: linear-gradient(180deg, #182544, #111b33); color: var(--text); }
    .btn:hover { filter: brightness(1.05); }
    .btn.primary { border-color: #2c47a1; background: linear-gradient(180deg, #2b50b8, #18317a); box-shadow: 0 6px 18px rgba(54, 92, 245, .25); }
    .dropzone { display: grid; place-items: center; text-align: center; border: 2px dashed var(--panel-border); border-radius: 12px; padding: 18px; }
    .dropzone.dragover { border-color: var(--accent); background: #365cf50d; }
    .badge { display: inline-flex; align-items: center; gap: 8px; padding: .35rem .6rem; border-radius: 999px; border: 1px solid var(--panel-border); font-weight: 600; }
    .badge.ok { color: #0f5132; background: #22c55e22; border-color: #22c55e55; }
    .badge.warn { color: #7a4a03; background: #f59e0b22; border-color: #f59e0b55; }
    .badge.danger { color: #7f1d1d; background: #ef444422; border-color: #ef444455; }
    .result { background: #0d172b; border: 1px solid var(--panel-border); border-radius: 12px; padding: 12px; }
    .result-top { display: flex; align-items: center; justify-content: space-between; gap: 12px; margin-bottom: 10px; }
    .result pre { margin: 0; white-space: pre-wrap; color: #dbe6ff; }
    footer { margin-top: 28px; text-align: center; color: var(--subtext); font-size: .9rem; }
    .row { display: flex; gap: 10px; flex-wrap: wrap; }
  </style>
  <script>
    function renderStatus(data) {
      const badge = document.getElementById('badge');
      const sourceEl = document.getElementById('source');
      const fileEl = document.getElementById('fileName');
      const details = document.getElementById('output');
      if (!data || data.error) {
        badge.className = 'badge warn';
        badge.textContent = 'Sin datos';
        sourceEl.textContent = '';
        fileEl.textContent = '';
        details.textContent = JSON.stringify(data || { error: 'Sin datos' }, null, 2);
        return;
      }
      fileEl.textContent = data.image || '';
      const isAI = !!data.ai_generated;
      badge.className = 'badge ' + (isAI ? 'danger' : 'ok');
      badge.textContent = isAI ? 'Generada por IA' : 'No IA (sin marca)';
      const sourceMap = { png_metadata: 'Metadatos PNG', sidecar_manifest: 'Manifest sidecar', none: 'No encontrado' };
      sourceEl.textContent = 'Origen: ' + (sourceMap[data.source] || '—');
      details.textContent = JSON.stringify(data, null, 2);
    }

    async function detectSample(sample) {
      const formData = new FormData();
      formData.append('sample', sample);
      const res = await fetch('/detect', { method: 'POST', body: formData });
      const data = await res.json();
      renderStatus(data);
    }

    async function detectUpload() {
      const fileInput = document.getElementById('file');
      if (!fileInput.files.length) { alert('Selecciona un archivo PNG.'); return; }
      const formData = new FormData();
      formData.append('file', fileInput.files[0]);
      const res = await fetch('/detect', { method: 'POST', body: formData });
      const data = await res.json();
      renderStatus(data);
    }

    function setupDropzone() {
      const dz = document.getElementById('dropzone');
      const fileInput = document.getElementById('file');
      ;['dragenter','dragover'].forEach(ev => dz.addEventListener(ev, e => { e.preventDefault(); dz.classList.add('dragover'); }))
      ;['dragleave','drop'].forEach(ev => dz.addEventListener(ev, e => { e.preventDefault(); dz.classList.remove('dragover'); }))
      dz.addEventListener('drop', e => {
        const files = e.dataTransfer.files;
        if (files && files.length) {
          fileInput.files = files;
          detectUpload();
        }
      });
    }

    window.addEventListener('DOMContentLoaded', setupDropzone);
  </script>
</head>
<body>
  <div class="container">
    <header>
      <h1>Detección de imágenes generadas por IA</h1>
      <p class="subtitle">Primero analiza metadatos PNG, luego busca un manifest sidecar por archivo.</p>
    </header>

    <section class="grid">
      <div class="card">
        <h3>Ejemplos rápidos</h3>
        <div class="preview" style="margin-bottom: 10px;">
          <img src="/gato1.png" alt="gato1" onerror="this.style.opacity=0;">
          <div>
            <div><strong>gato1.png</strong> <span class="muted">(real)</span></div>
            <div class="row"><button class="btn" onclick="detectSample('gato1')">Detectar gato1</button></div>
          </div>
        </div>
        <div class="preview">
          <img src="/gato2.png" alt="gato2" onerror="this.style.opacity=0;">
          <div>
            <div><strong>gato2.png</strong> <span class="muted">(IA)</span></div>
            <div class="row"><button class="btn" onclick="detectSample('gato2')">Detectar gato2</button></div>
          </div>
        </div>
      </div>

      <div class="card">
        <h3>Subir imagen</h3>
        <div id="dropzone" class="dropzone">
          <div>
            <div class="muted" style="margin-bottom: 8px;">Arrastra un PNG aquí o selecciónalo</div>
            <div class="row">
              <input type="file" id="file" accept="image/png" />
              <button class="btn primary" onclick="detectUpload()">Detectar imagen</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section style="margin-top: 18px;" class="card">
      <div class="result-top">
        <div class="row" style="align-items:center; gap: 10px;">
          <span id="badge" class="badge warn">Esperando prueba…</span>
          <span id="source" class="muted"></span>
        </div>
        <div id="fileName" class="muted"></div>
      </div>
      <div class="result"><pre id="output">Esperando prueba...</pre></div>
    </section>
  </div>
</body>
</html>


